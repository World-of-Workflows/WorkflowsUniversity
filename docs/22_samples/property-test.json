{"$id":"1","definitionId":"b4cdcb5ada794d05994c9eb197b12b6e","versionId":"1db40a1dba7c4c59a843f826181c60fc","name":"PropertyTest","displayName":"PropertyTest","version":9,"variables":{"$id":"2","data":{}},"customAttributes":{"$id":"3","data":{}},"isSingleton":false,"persistenceBehavior":"WorkflowBurst","deleteCompletedInstances":false,"isPublished":false,"isLatest":true,"createdAt":"2024-08-06T10:26:21.6752724Z","activities":[{"$id":"4","activityId":"eae5d554-e678-4e06-8ac2-35a02c97675d","type":"WriteHttpResponse","displayName":"HTTP Response","x":420,"y":180,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"5","name":"Content","syntax":"Liquid","expressions":{"$id":"6","Liquid":"<!DOCTYPE html>\r\n<html class=\"h-full bg-white\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>xxx Services Portal</title>\r\n    <link href=\"https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css\" rel=\"stylesheet\">\r\n \r\n    <style>\r\n\r\n        select[name=\"contactNames\"] {\r\n            font-weight: bold;\r\n        }\r\n        .drag-area {\r\n            border: 2px dashed #4B5563;\r\n            border-radius: 8px;\r\n        }\r\n        .drag-over {\r\n            background-color: #F3F4F6;\r\n        }\r\n\r\n     /* Additional styles to ensure fixed header and sidebar */\r\n        .fixed-header {\r\n            position: fixed;\r\n            width: 100%;\r\n            top: 0;\r\n            z-index: 1000; /* Ensure header is above other content */\r\n        }\r\n\r\n        .fixed-sidebar {\r\n            position: fixed;\r\n            height: 100%;\r\n            left: 0;\r\n            top: 0;\r\n            z-index: 900; /* Ensure sidebar is above other content */\r\n        }\r\n\r\n        .content-with-fixed-elements {\r\n            margin-top: 56px; /* Adjust based on the height of your fixed header */\r\n            margin-left: 200px; /* Adjust based on the width of your fixed sidebar, if always visible */\r\n        }\r\n    \r\n    /* Define the hover style for the link */\r\n    .highlight-link {\r\n        color: blue; /* Set the color of the link */\r\n    }\r\n\r\n    .highlight-link:hover {\r\n        background-color: lightgray; /* Change background color on hover */\r\n        cursor: pointer; /* Change cursor to pointer on hover */\r\n    }\r\n\r\n     #ContractTerm, #DateSelector, #QuoteSelection {\r\n        width: 400px; /* Set the width to your desired value */\r\n        /* Add any other styles as needed */\r\n    }\r\n    </style>\r\n\r\n</head>\r\n\r\n<body class=\"bg-gray-100\">\r\n    <!-- Top Bar -->\r\n    <div class=\"fixed-header bg-white shadow-md px-4 py-3 flex items-center justify-between z-10\">\r\n        <!-- Logo -->\r\n        <div class=\"flex items-center\">\r\n            <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHwAAAAeCAIAAABhQO24AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAnqUEvk1X5xIUOqoVS4eYa78VdnZOBCnp9ZOwz1toHuTyDmE9ZGKuObgYlc9E/Ed0Ygq0ARxmoLcWbgSGEO9oH+g8f0SuqAvc5rnHMMpBX121BziYQw7LNRki+3PhZanYmu58KrMPiGHZDYVw+XJRM78J/VMGfyT+k4kdvsldAWmDfyzcORR42zP1LZZkHZ/mvHlOvD1b3PjLknywUPOAAAAAElFTkSuQmCC\" \r\n            alt=\"Logo\" > <!-- Replace 'logo.png' with the actual logo path -->\r\n            <span class=\"ml-4 font-semibold text-xl tracking-tight\"> Customer Portal</span>\r\n        </div>\r\n        \r\n       <!-- Logout Section -->\r\n        <div class=\"logout-section flex items-center\">\r\n            <p id=\"usernamePlaceholder\" class=\"mr-4\"></p>\r\n            <button type=\"button\" id=\"logoutButton\" class=\"bg-red-500 hover:bg-red-700 text-white text-sm font-bold py-2 px-4 rounded\">\r\n                Logout\r\n            </button>\r\n        </div>\r\n\r\n      \r\n\r\n    </div>\r\n    <div class=\"flex h-screen\">\r\n        <!-- Sidebar -->\r\n        <div class=\"fixed-sidebar bg-blue-300 w-64 space-y-9 py-7 px-2 transition duration-200 ease-in-out\">\r\n            <!-- Menu Button for Mobile -->\r\n            <button id=\"menuBtn\" class=\"text-white md:hidden\">\r\n                <span>Menu</span>\r\n            </button>\r\n            <!-- Menu Items -->\r\n            <nav>\r\n              <div><p><strong>{{Variables.Company.Title}}</strong></p></div>\r\n               <a href=\"#MenuItem1\" id=\"MenuItem1\"\r\n                    class=\"menu-item text-indigo-900 block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white\">MenuItem1</a>\r\n                <a href=\"#MenuItem2\" id=\"MenuItem2\"\r\n                    class=\"menu-item text-indigo-900 block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white\">MenuItem2</a>\r\n                <a href=\"#MenuItem3\" id=\"MenuItem3\"\r\n                    class=\"menu-item text-indigo-900 block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white\">MenuItem3</a>\r\n                <a href=\"#MenuItem4\" id=\"MenuItem4\"\r\n                    class=\"menu-item text-indigo-900 block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white\">MenuItem4</a>\r\n                <a href=\"#AdminMenu\" id=\"AdminMenu\"\r\n                    class=\"{% if Variables.IsAdministrator == false %} hidden {% endif %} menu-item text-indigo-900 block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white\">Admin menu</a>\r\n               \r\n            </nav>\r\n        </div>\r\n        <!-- Main Content -->\r\n        <div class=\"content-with-fixed-elements flex-1 overflow-auto p-10\">\r\n            <!-- Your Scrollable Content Here -->\r\n       \r\n        \r\n     <!-- Tailwind CSS Form -->\r\n<div id=\"addPropertyForm\" class=\"flex-1 p-1\">\r\n    <div class=\"px-4 sm:px-6 lg:px-8\">\r\n        <div class=\"sm:flex sm:items-center\">\r\n            <div class=\"sm:flex-auto\">\r\n                <h1 class=\"text-lg font-semibold leading-6 text-gray-900\">Property</h1>\r\n                {% if Variables.Property %}\r\n                <p class=\"mt-2 text-sm text-gray-700\">Update the Property <strong>{{ Variables.Property.BuildingName }}</strong>associated with {{ Variables.Company.Title}} </p><br>\r\n                {% else %}\r\n                <p class=\"mt-2 text-sm text-gray-700\">Add a new Property associated with {{ Variables.Company.Title}} </p><br>\r\n                {% endif %}\r\n            </div>\r\n        </div>\r\n        <div class=\"mt-5 md:mt-0 md:col-span-2\">\r\n            <form method='post' action=\"/someURL\" id=\"myForm\" class=\"shadow overflow-scroll sm:rounded-md\">\r\n                <div class=\"px-4 py-5 bg-white space-y-6 sm:p-6\">\r\n                    <h1 class=\"text-xl font-medium leading-6 text-gray-900\">Enter Property Details</h1>\r\n                    <div class=\"hidden\">\r\n                        <!-- add any fields needed for your workflow, that are hidden from the user -->\r\n                        <input type=\"hidden\" id=\"objectid\" name=\"id\"  value=\"{{Variables.Property.ObjectId}}\">\r\n                        <input type=\"hidden\" id=\"type\" name=\"type\" required value=\"Property\">\r\n                        <input type=\"hidden\" id=\"action\" name=\"action\" required value=\"saverow\">\r\n                        <input type=\"hidden\" id=\"username\" name=\"username\" required value=\"{{Variables.UserName}}\">\r\n                        <input type=\"hidden\" id=\"name\" name=\"name\" required value=\"{{Variables.Name}}\">\r\n                        <input type=\"hidden\" id=\"Client\" name=\"Client\" required value={{Variables.Company.ObjectId}}>\r\n                        \r\n                    </div>\r\n\r\n                    <div id=\"theForm\"  class=\"grid grid-cols-2 gap-6\">\r\n                        <div class=\"col-span-3 sm:col-span-2\">\r\n                            <label for=\"buildingName\" class=\"block text-sm font-medium text-gray-700\">Building Name:</label>\r\n                            <input type=\"text\" id=\"buildingName\" name=\"BuildingName\"  value=\"{{Variables.Property.BuildingName}}\" \r\n                            oninvalid=\"this.setCustomValidity('Please enter the building name')\"\r\n                            oninput=\"this.setCustomValidity('')\"\r\n                            class=\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100\">\r\n                        </div>\r\n                        <div class=\"col-span-3 sm:col-span-2\">\r\n                            <label for=\"autocomplete\" class=\"block text-sm font-medium text-gray-700\">Lookup the Street Address:</label>\r\n                            <input type=\"text\" id=\"autocomplete\" name=\"Address\" required value=\"{{Variables.Property.Address}}\"  class=\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100\">\r\n                        </div>\r\n                        <div class=\"col-span-3 sm:col-span-2\">\r\n                            <label for=\"buildingNumber\" class=\"block text-sm font-medium text-gray-700\">Number in Street:</label>\r\n                            <input type=\"text\" id=\"buildingNumber\" name=\"BuildingNumber\" required value=\"{{Variables.Property.BuildingNumber}}\" class=\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100\">\r\n                        </div>\r\n                        <div class=\"col-span-3 sm:col-span-2\">\r\n                            <label for=\"buildingStreet\" class=\"block text-sm font-medium text-gray-700\">Street:</label>\r\n                            <input type=\"text\" id=\"buildingStreet\" name=\"BuildingStreet\" required value=\"{{Variables.Property.BuildingStreet}}\" class=\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100\">\r\n                        </div>\r\n                        <div class=\"col-span-3 sm:col-span-2\">\r\n                            <label for=\"buildingSuburb\" class=\"block text-sm font-medium text-gray-700\">Suburb:</label>\r\n                            <input type=\"text\" id=\"buildingSuburb\" name=\"BuildingSuburb\" required value=\"{{Variables.Property.BuildingSuburb}}\" class=\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100\">\r\n                        </div>\r\n                        <div class=\"col-span-3 sm:col-span-2\">\r\n                            <label for=\"buildingState\" class=\"block text-sm font-medium text-gray-700\">State:</label>\r\n                            <input type=\"text\" id=\"buildingState\" name=\"BuildingState\" required value=\"{{Variables.Property.BuildingState}}\" class=\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100\">\r\n                        </div>\r\n                        <div class=\"col-span-3 sm:col-span-2\">\r\n                            <label for=\"buildingPostcode\" class=\"block text-sm font-medium text-gray-700\">Postcode:</label>\r\n                            <input type=\"text\" id=\"buildingPostcode\" name=\"BuildingPostcode\" required value=\"{{Variables.Property.BuildingPostcode}}\" class=\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100\">\r\n                        </div>\r\n                        <div class=\"col-span-3 sm:col-span-2\">\r\n                            <label for=\"buildingCountry\" class=\"block text-sm font-medium text-gray-700\">Country:</label>\r\n                            <input type=\"text\" id=\"buildingCountry\" name=\"BuildingCountry\" required value=\"{{Variables.Property.BuildingCountry | Default:'Australia'}}\" class=\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100\">\r\n                        </div>\r\n                    \r\n                      \r\n                    \r\n                        <div class=\"px-4 py-3 bg-gray-50 text-right sm:px-6\">\r\n                            <button type=\"button\" onclick=\"window.history.back()\" id=\"cancelButton\" class=\"ml-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\">Cancel</button>\r\n                            <button type=\"submit\" id=\"submitButton\" class=\"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\">Save</button>\r\n                        </div>\r\n                    \r\n                    </div>        \r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</div>\r\n<script src=\"https://maps.googleapis.com/maps/api/js?key={{Variables.APIKey}}&libraries=places&callback=initAutocomplete&loading=async\" async defer ></script>\r\n\r\n<script>\r\n      document.addEventListener('DOMContentLoaded', function() {\r\n\r\n\r\n    });\r\n\r\n\r\n    function initAutocomplete() {\r\n    const autocomplete = new google.maps.places.Autocomplete(\r\n        document.getElementById('autocomplete'), \r\n        {\r\n        types: ['geocode'],\r\n        componentRestrictions: {country: \"au\"}\r\n        }\r\n    );\r\n\r\n    autocomplete.addListener('place_changed', function() {\r\n        const place = autocomplete.getPlace();\r\n        console.log(place)\r\n        \r\n        // Variables to store state and postcode\r\n        let state = '';\r\n        let street = '';\r\n        let streetNumber = '';\r\n        let postcode = '';\r\n        let suburb = '';\r\n        let country = ''\r\n\r\n        // Loop over the address components of the selected place\r\n        for (const component of place.address_components) {\r\n            const componentType = component.types[0];\r\n\r\n            // Check for the unit number\r\n            if (componentType === \"subpremise\") {\r\n                streetNumber = component.long_name+\"/\";\r\n            }\r\n            // Check for the streetNumber\r\n            if (componentType === \"street_number\") {\r\n                streetNumber += component.long_name;\r\n            }\r\n\r\n            // Check for the street\r\n            if (componentType === \"route\") {\r\n                street = component.long_name;\r\n            }\r\n\r\n            // Check for the suburb\r\n            if (componentType === \"locality\") {\r\n                suburb = component.long_name;\r\n            }\r\n\r\n            // Check for the postcode\r\n            if (componentType === \"postal_code\") {\r\n                postcode = component.long_name;\r\n            }\r\n\r\n            // Check for the state\r\n            if (componentType === \"administrative_area_level_1\") {\r\n                state = component.long_name; // or short_name for the abbreviated state\r\n            }\r\n            // Check for the country\r\n            if (componentType === \"country\") {\r\n                country = component.long_name;\r\n            }\r\n\r\n        }\r\n\r\n        // Update the corresponding input fields\r\n        document.getElementById('buildingNumber').value = streetNumber;\r\n        document.getElementById('buildingStreet').value = street;\r\n        document.getElementById('buildingSuburb').value = suburb;\r\n        document.getElementById('buildingState').value = state;\r\n        document.getElementById('buildingPostcode').value = postcode;\r\n        document.getElementById('buildingCountry').value = country;\r\n        if (document.getElementById('buildingName').value == '') {\r\n            document.getElementById('buildingName').value = streetNumber + ' '+ street + ' '+suburb\r\n        }\r\n        \r\n        \r\n    });\r\n    }\r\n\r\n\r\n</script>\r\n\r\n<!-- Script for action buttons -->\r\n<script>\r\n    \r\n    document.getElementById(\"logoutButton\").addEventListener(\"click\", function() {\r\n        // Redirect the user to /azLogoff endpoint\r\n        window.location.href = \"/azLogoff\";\r\n    });\r\n\r\n\r\nfunction getUserNameorImpersonated() {\r\n    let username = localStorage.getItem(\"username\");  \r\n    const impersonatedUsername = localStorage.getItem(\"impersonatedUsername\");\r\n //   alert('impersonatedUsername')\r\n    if (impersonatedUsername) {\r\n        username = impersonatedUsername\r\n    }\r\n    return username\r\n}\r\n\r\nfunction getNameOrImpersonated() {\r\n    let name = localStorage.getItem(\"name\");\r\n    const impersonatedName = localStorage.getItem(\"impersonatedName\");\r\n    if (impersonatedName) {\r\n        name = impersonatedName\r\n    }\r\n    return name\r\n\r\n}\r\n\r\n    document.getElementById('menuBtn').addEventListener('click', function () {\r\n        document.getElementById('sidebar').classList.toggle('-translate-x-full');\r\n    });\r\n\r\n    document.querySelectorAll('.menu-item').forEach(item => {\r\n        item.addEventListener('click', function (event) {\r\n            event.preventDefault();\r\n\r\n            const section = item.getAttribute('href').substring(1);\r\n          //  alert(section)\r\n            if (section == \"dashboard\") {\r\n                document.getElementById('properties').classList.add('hidden');\r\n                document.getElementById('customers').classList.add('hidden');\r\n                document.getElementById('dashboard').classList.remove('hidden');\r\n                document.getElementById('opportunities').classList.add('hidden');\r\n                document.getElementById('contacts').classList.add('hidden');\r\n            } else if (section == \"MenuItem1\") {\r\n                menuRequest(\"/focus\",\"\")\r\n            } else if (section == \"MenuItem2\") {\r\n                menuRequest(\"/focus\",\"Services\")\r\n            } else if (section == \"MenuItem3\") {\r\n                menuRequest(\"/focus\",\"Quotes\")\r\n            } else if (section == \"MenuItem4\") {\r\n                menuRequest(\"/focus\",\"Agreements\")\r\n            } else if (section == \"AdminMenu\") {\r\n                menuRequest(\"/adminMenu\",\"Companies\")\r\n            }\r\n\r\n        });\r\n    });\r\n\r\n\r\n    function menuRequest(actionURL,action) {\r\n      // Create a form dynamically\r\n      \r\n        const username = getUserNameorImpersonated()\r\n        const name = getNameOrImpersonated()\r\n    \r\n      const form = document.createElement('form');\r\n      form.method = 'POST';\r\n      form.action = actionURL;\r\n\r\n\r\n    // Add user field to the form\r\n      const userField = document.createElement('input');\r\n      userField.type = 'hidden';\r\n      userField.name = 'username';\r\n      userField.value = username;\r\n      form.appendChild(userField);\r\n\r\n    // Add name field to the form\r\n      const nameField = document.createElement('input');\r\n      nameField.type = 'hidden';\r\n      nameField.name = 'name';\r\n      nameField.value = name;\r\n      form.appendChild(nameField);\r\n\r\n     \r\n      // Add action field to the form\r\n      const actionField = document.createElement('input');\r\n      actionField.type = 'hidden';\r\n      actionField.name = 'action';\r\n      actionField.value = action;\r\n      form.appendChild(actionField);\r\n\r\n      // Add the form to the DOM and submit it\r\n      document.body.appendChild(form);\r\n      form.submit();\r\n      }\r\n\r\nfunction impersonateRequest(actionURL,action, name, username) {\r\n      // Create a form dynamically\r\n      //debugger\r\n      //const name = localStorage.getItem(\"name\");\r\n      //const username = localStorage.getItem(\"username\");\r\n       \r\n      const form = document.createElement('form');\r\n      form.method = 'POST';\r\n      form.action = actionURL;\r\n\r\n\r\n    // Add user field to the form\r\n      const userField = document.createElement('input');\r\n      userField.type = 'hidden';\r\n      userField.name = 'username';\r\n      userField.value = username;\r\n      form.appendChild(userField);\r\n\r\n    // Add name field to the form\r\n      const nameField = document.createElement('input');\r\n      nameField.type = 'hidden';\r\n      nameField.name = 'name';\r\n      nameField.value = name;\r\n      form.appendChild(nameField);\r\n\r\n     \r\n      // Add action field to the form\r\n      const actionField = document.createElement('input');\r\n      actionField.type = 'hidden';\r\n      actionField.name = 'action';\r\n      actionField.value = action;\r\n      form.appendChild(actionField);\r\n\r\n      // Add the form to the DOM and submit it\r\n      document.body.appendChild(form);\r\n      form.submit();\r\n      }\r\n   \r\n\r\n\r\n\r\n\r\n</script>\r\n </div>  <!-- end of scrollable content -->\r\n</body>\r\n\r\n</html>"}},{"$id":"7","name":"ContentType","expressions":{"$id":"8","Literal":"text/html"}},{"$id":"9","name":"StatusCode","expressions":{"$id":"10","Literal":"OK"}},{"$id":"11","name":"CharSet","expressions":{"$id":"12","Literal":"utf-8"}},{"$id":"13","name":"ResponseHeaders","expressions":{"$id":"14"}}],"propertyStorageProviders":{"$id":"15"}},{"$id":"16","activityId":"dfd272a6-9208-47aa-91ad-fa24a7e1bf9c","type":"HttpEndpoint","displayName":"HTTP Endpoint","x":64,"y":64,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"17","name":"Path","expressions":{"$id":"18","Literal":"/prop"}},{"$id":"19","name":"Methods","expressions":{"$id":"20","Json":"[\"GET\"]"}},{"$id":"21","name":"ReadContent","expressions":{"$id":"22"}},{"$id":"23","name":"TargetType","expressions":{"$id":"24"}},{"$id":"25","name":"Schema","syntax":"Literal","expressions":{"$id":"26","Literal":""}},{"$id":"27","name":"Authorize","expressions":{"$id":"28"}},{"$id":"29","name":"Policy","expressions":{"$id":"30"}},{"$id":"31","name":"AuthorizeWithCustomHeader","expressions":{"$id":"32"}},{"$id":"33","name":"CustomHeaderName","expressions":{"$id":"34"}},{"$id":"35","name":"CustomHeaderValue","expressions":{"$id":"36"}}],"propertyStorageProviders":{"$id":"37"}}],"connections":[{"$id":"38","sourceActivityId":"dfd272a6-9208-47aa-91ad-fa24a7e1bf9c","targetActivityId":"eae5d554-e678-4e06-8ac2-35a02c97675d","outcome":"Done"}],"id":"1db40a1dba7c4c59a843f826181c60fc"}