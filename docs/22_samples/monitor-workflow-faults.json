{"$id":"1","definitionId":"e870e7fbc876404cbe81f42678ceb358","versionId":"f382490eb4824f46a7aa6540ad4a3ed9","name":"MonitorWorkflowFaults","displayName":"Monitor Workflow Faults","version":3,"variables":{"$id":"2","data":{}},"customAttributes":{"$id":"3","data":{}},"isSingleton":false,"persistenceBehavior":"WorkflowBurst","deleteCompletedInstances":false,"isPublished":true,"isLatest":true,"createdAt":"2024-08-11T07:34:11.9879823Z","activities":[{"$id":"4","activityId":"5ff4b4da-5a07-4dda-9c72-61b414e0f055","type":"HttpEndpoint","name":"httpStart","displayName":"HTTP /monitorWorkfow","x":-1411,"y":1186,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"5","name":"Path","expressions":{"$id":"6","Literal":"/monitorWorkfow"}},{"$id":"7","name":"Methods","expressions":{"$id":"8","Json":"[\"GET\"]"}},{"$id":"9","name":"ReadContent","expressions":{"$id":"10","Literal":"true"}},{"$id":"11","name":"TargetType","expressions":{"$id":"12"}},{"$id":"13","name":"Schema","syntax":"Literal","expressions":{"$id":"14","Literal":""}},{"$id":"15","name":"Authorize","expressions":{"$id":"16"}},{"$id":"17","name":"Policy","expressions":{"$id":"18"}},{"$id":"19","name":"AuthorizeWithCustomHeader","expressions":{"$id":"20"}},{"$id":"21","name":"CustomHeaderName","expressions":{"$id":"22"}},{"$id":"23","name":"CustomHeaderValue","expressions":{"$id":"24"}}],"propertyStorageProviders":{"$id":"25"}},{"$id":"26","activityId":"5f139e7c-82f9-45ab-80e7-8738836039ac","type":"SetVariable","displayName":"Set ChatResponse","x":2600,"y":3887,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"27","name":"VariableName","expressions":{"$id":"28","Literal":"ChatResponse"}},{"$id":"29","name":"Value","syntax":"JavaScript","expressions":{"$id":"30","JavaScript":"activities.GetResponse.Output()"}}],"propertyStorageProviders":{"$id":"31"}},{"$id":"32","activityId":"9da2b7ba-c5d7-423f-b589-c61a0b4f41bb","type":"ObjectInstanceUpdate","displayName":"Update Object Instance","x":2600,"y":4133,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"33","name":"InstanceId","syntax":"JavaScript","expressions":{"$id":"34","JavaScript":"getVariable(\"FaultedWorkflowInstance\").ObjectId"}},{"$id":"35","name":"ClearOmittedFields","expressions":{"$id":"36"}},{"$id":"37","name":"Values","syntax":"JavaScript","expressions":{"$id":"38","JavaScript":"return {\r\n    \"ChatAnalysis\":getVariable(\"ChatResponse\").choices[0].message.content,\r\n    \"Reported\":true,\r\n    \"LinkToInstance\":'https://'+getVariable(\"host\")+'/workflowdashboard/workflow-instances/'+getVariable(\"FaultedLog\").id\r\n}"}},{"$id":"39","name":"VariableName","expressions":{"$id":"40","Literal":"FaultedWorkflowInstance"}}],"propertyStorageProviders":{"$id":"41"}},{"$id":"42","activityId":"3bb46982-bf0a-436f-a9bb-2938772ad535","type":"MarkdownToHtml","name":"MakeHTML","displayName":"Markdown To Html","x":3157,"y":4092,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"43","name":"MarkdownString","syntax":"JavaScript","expressions":{"$id":"44","JavaScript":"'Fault url : https://'+getVariable(\"host\")+'/workflowdashboard/workflow-instances/'+getVariable(\"FaultedLog\").id+\"\\n\\n\"+\r\ngetVariable(\"ChatResponse\").choices[0].message.content"}}],"propertyStorageProviders":{"$id":"45"}},{"$id":"46","activityId":"6511e0d6-6749-4f1c-b16b-b4a8512d28eb","type":"MSGraphSendEmail","displayName":"Send Email","x":3231,"y":4329,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"47","name":"ToAddress","expressions":{"$id":"48","Literal":"jim@tribetech.com.au"}},{"$id":"49","name":"CcAddress","expressions":{"$id":"50"}},{"$id":"51","name":"Subject","expressions":{"$id":"52","Literal":"Faulted workflow"}},{"$id":"53","name":"MailboxEmail","expressions":{"$id":"54"}},{"$id":"55","name":"BodyType","expressions":{"$id":"56","Literal":"Html"}},{"$id":"57","name":"Importance","expressions":{"$id":"58","Literal":"normal"}},{"$id":"59","name":"BodyContent","syntax":"JavaScript","expressions":{"$id":"60","JavaScript":"activities.MakeHTML.Output()"}},{"$id":"61","name":"Files","syntax":"JavaScript","expressions":{"$id":"62","JavaScript":"return {\r\n    [\"faultingInstance.json\"]:base64Encode(getVariable(\"FaultedLog\")),\r\n    [\"workflow-\"+getVariable(\"Workflow\").name+\"_v\"+getVariable(\"Workflow\").version+\".json\"]:base64Encode(getVariable(\"Workflow\")),\r\n    [\"ExecutionLog-\"+getVariable(\"Workflow\").name+\"_v\"+getVariable(\"Workflow\").version+\".json\"]:base64Encode(getVariable(\"ExecutionLog\")),\r\n    \r\n}"}},{"$id":"63","name":"SaveToSentItems","expressions":{"$id":"64"}},{"$id":"65","name":"Authorization","expressions":{"$id":"66","Secret":"OAuth2:Office365 wow@"}}],"propertyStorageProviders":{"$id":"67"}},{"$id":"68","activityId":"2b9817bf-3a71-44dd-854a-4a0a29702da1","type":"ChatCompletions","name":"GetResponse","displayName":"Chat Completions Activity GetResponse","x":2600,"y":3640,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"69","name":"Model","syntax":"JavaScript","expressions":{"$id":"70","Literal":"gpt-4","JavaScript":"'gpt-4o'"}},{"$id":"71","name":"MessageList","expressions":{"$id":"72"}},{"$id":"73","name":"SystemPrompt","syntax":"JavaScript","expressions":{"$id":"74","Literal":"You are a business analyst with World of Workflows.  you understand Elsa workflows.  You always produce output in markdown.  Do not include a mermaid diagram.  Do not include a conclusion paragraph.\n\nDo include: an Overview which describes what the workflow is designed to achieve.  Then include \n1: a detailed section for the sequence flow, \n2: a table of Workflow Activities showing displayName , properties.values and the purpose of any JavaScript\n3: a table of variables and how they are used, \n4: a table of javascript functions and what calls them.","JavaScript":"getVariable(\"WFDocumentorSystemPromptAnalysis\")"}},{"$id":"75","name":"UserPrompt","syntax":"JavaScript","expressions":{"$id":"76","JavaScript":"var prompt = 'describe the exact fault that occurred in this workflow.  Do not list all of the possible faults, only tell me the cause of the actual faults. '\r\nprompt += ' this is the workflow in JSON: '\r\nprompt += jsonEncode(getVariable(\"ExecutionLog\"))\r\nreturn prompt"}},{"$id":"77","name":"FrequencyPenalty","expressions":{"$id":"78"}},{"$id":"79","name":"MaxTokens","expressions":{"$id":"80"}},{"$id":"81","name":"PresencePenalty","expressions":{"$id":"82"}},{"$id":"83","name":"Temperature","expressions":{"$id":"84"}},{"$id":"85","name":"TopP","expressions":{"$id":"86"}},{"$id":"87","name":"Authorization","expressions":{"$id":"88","Secret":"Authorization:chatgpt-released"}},{"$id":"89","name":"BaseUrl","expressions":{"$id":"90","Literal":"https://api.openai.com/v1"}}],"propertyStorageProviders":{"$id":"91"}},{"$id":"92","activityId":"0924eb22-8341-4e1d-85ec-eaf201f2c6a3","type":"SetVariable","displayName":"Set Workflow","x":2500,"y":3020,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"93","name":"VariableName","expressions":{"$id":"94","Literal":"Workflow"}},{"$id":"95","name":"Value","syntax":"JavaScript","expressions":{"$id":"96","JavaScript":"activities.getWorkflowDefinition.ResponseContent()"}}],"propertyStorageProviders":{"$id":"97"}},{"$id":"98","activityId":"62b89480-77c1-4608-b343-e5c46a9d4bb4","type":"If","displayName":"If FaultedWorkflowInstances found","x":1660,"y":2220,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"99","name":"Condition","syntax":"JavaScript","expressions":{"$id":"100","JavaScript":"activities.ListFaultedWorkflowInstancesID.Output().length > 0"}}],"propertyStorageProviders":{"$id":"101"}},{"$id":"102","activityId":"84a50058-070f-4e3c-9591-6bd3555fd11c","type":"ObjectInstanceList","name":"ListFaultedWorkflowInstancesID","displayName":"List FaultedWorkflowInstances for this ID","x":960,"y":2220,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"103","name":"ObjectType","syntax":"Literal","expressions":{"$id":"104","Literal":"FaultedWorkflowInstances"}},{"$id":"105","name":"Expand","expressions":{"$id":"106"}},{"$id":"107","name":"Filter","syntax":"JavaScript","expressions":{"$id":"108","JavaScript":"\"WorkflowInstanceID eq '\"+getVariable(\"Instance\").id+\"'\""}},{"$id":"109","name":"Skip","expressions":{"$id":"110"}},{"$id":"111","name":"Limit","expressions":{"$id":"112"}},{"$id":"113","name":"OrderBy","expressions":{"$id":"114"}}],"propertyStorageProviders":{"$id":"115"}},{"$id":"116","activityId":"999060f3-1ca9-4913-a28d-16bba56358fd","type":"WriteLine","displayName":"Write Line","x":800,"y":2120,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"117","name":"Text","syntax":"JavaScript","expressions":{"$id":"118","JavaScript":"JSON.stringify(getVariable(\"Instance\"),null,2)"}}],"propertyStorageProviders":{"$id":"119"}},{"$id":"120","activityId":"4ba5965d-4790-4c77-9d79-27622e7765d2","type":"RunJavaScript","displayName":"set up variables from settings","x":-780,"y":1560,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"121","name":"Script","syntax":"Literal","expressions":{"$id":"122","Literal":"function getValueByTitle(jsonData, key) {\r\n   \r\n    for (let item of jsonData) {\r\n        if (item.Key === key) {\r\n            return item.Data1;\r\n        }\r\n    }\r\n\r\n    return null; // Or handle \"key not found\" as needed\r\n}\r\n\r\nsetVariable(\"WFDocumentorSystemPromptAnalysis\", getValueByTitle(activities.ListSettings.Output(),\"WFDocumentorSystemPromptAnalysis\"));\r\n\r\n"}},{"$id":"123","name":"PossibleOutcomes","expressions":{"$id":"124"}}],"propertyStorageProviders":{"$id":"125"}},{"$id":"126","activityId":"5fdcb542-0428-4a41-8a96-ce7794233087","type":"ObjectInstanceList","name":"ListSettings","displayName":"List Settings","x":-980,"y":1440,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"127","name":"ObjectType","syntax":"Literal","expressions":{"$id":"128","Literal":"Settings"}},{"$id":"129","name":"Filter","expressions":{"$id":"130"}},{"$id":"131","name":"Skip","expressions":{"$id":"132"}},{"$id":"133","name":"Limit","expressions":{"$id":"134"}},{"$id":"135","name":"OrderBy","expressions":{"$id":"136"}},{"$id":"137","name":"Expand","expressions":{"$id":"138"}}],"propertyStorageProviders":{"$id":"139"}},{"$id":"140","activityId":"56456f47-07cf-4d30-b47d-fdfdecf6beb7","type":"Correlate","displayName":"Correlate","x":-900,"y":1260,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"141","name":"Value","syntax":"JavaScript","expressions":{"$id":"142","Literal":"Getting the list of workflows","JavaScript":"'Getting the list of faulted workflow instances '"}}],"propertyStorageProviders":{"$id":"143"}},{"$id":"144","activityId":"b6d9495a-628a-4537-89a1-f8be3e1e6b1e","type":"SendHttpRequest","name":"requestFaultedWorkflowInstances","displayName":"Send HTTP Request faulted WorkflowInstances","x":-900,"y":1700,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"145","name":"Url","syntax":"JavaScript","expressions":{"$id":"146","Literal":"https://localhost:7063/v1/workflow-instances?status=Faulted&page=0&pageSize=25","JavaScript":"'https://'+getVariable(\"host\")+'/v1/workflow-instances?status=Faulted&page=0&pageSize=25'"}},{"$id":"147","name":"Method","expressions":{"$id":"148","Literal":"GET"}},{"$id":"149","name":"Content","expressions":{"$id":"150"}},{"$id":"151","name":"ContentType","expressions":{"$id":"152","Literal":"application/json"}},{"$id":"153","name":"ReadContent","expressions":{"$id":"154","Literal":"true"}},{"$id":"155","name":"ResponseContentParserName","expressions":{"$id":"156","Literal":""}},{"$id":"157","name":"ResponseContentTargetType","expressions":{"$id":"158"}},{"$id":"159","name":"SupportedStatusCodes","expressions":{"$id":"160","Json":"[\"200\"]"}},{"$id":"161","name":"Authorization","expressions":{"$id":"162","Secret":"OAuth2:newJimtest API oAuth"}},{"$id":"163","name":"RequestHeaders","expressions":{"$id":"164"}}],"propertyStorageProviders":{"$id":"165"}},{"$id":"166","activityId":"0d6d4e73-df64-4c6d-869e-2797047e80e8","type":"SetVariable","displayName":"Set FaultedLog","x":2060,"y":2660,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"167","name":"VariableName","expressions":{"$id":"168","Literal":"FaultedLog"}},{"$id":"169","name":"Value","syntax":"JavaScript","expressions":{"$id":"170","JavaScript":"activities.getFaultedLog.ResponseContent()"}}],"propertyStorageProviders":{"$id":"171"}},{"$id":"172","activityId":"c25137b1-d9e7-4830-943b-9977e992a7b6","type":"WriteLine","displayName":"Write Line faultedlog","x":1900,"y":2820,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"173","name":"Text","syntax":"JavaScript","expressions":{"$id":"174","JavaScript":"getVariable(\"FaultedLog\")"}}],"propertyStorageProviders":{"$id":"175"}},{"$id":"176","activityId":"f70a46a8-a91f-45e4-8135-2073c87efc06","type":"SendHttpRequest","name":"getWorkflowDefinition","displayName":"Send HTTP Request getWorkflowDefinition","x":1840,"y":3000,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"177","name":"Url","syntax":"JavaScript","expressions":{"$id":"178","Literal":"https://localhost:7063/v1/workflow-instances?","JavaScript":"'https://'+getVariable(\"host\")+'/v1/workflow-definitions/'+getVariable(\"Instance\").definitionVersionId"}},{"$id":"179","name":"Method","expressions":{"$id":"180","Literal":"GET"}},{"$id":"181","name":"Content","expressions":{"$id":"182"}},{"$id":"183","name":"ContentType","expressions":{"$id":"184","Literal":"application/json"}},{"$id":"185","name":"ReadContent","expressions":{"$id":"186","Literal":"true"}},{"$id":"187","name":"ResponseContentParserName","expressions":{"$id":"188","Literal":""}},{"$id":"189","name":"ResponseContentTargetType","expressions":{"$id":"190"}},{"$id":"191","name":"SupportedStatusCodes","expressions":{"$id":"192","Json":"[\"200\"]"}},{"$id":"193","name":"Authorization","expressions":{"$id":"194","Secret":"OAuth2:newJimtest API oAuth"}},{"$id":"195","name":"RequestHeaders","expressions":{"$id":"196"}}],"propertyStorageProviders":{"$id":"197"}},{"$id":"198","activityId":"3a7818dd-4d67-45a9-b0e8-c6d2eadeca81","type":"ObjectInstanceCreate","displayName":"Create FaultedWorkflowInstance","x":2060,"y":3320,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"199","name":"ObjectType","syntax":"Literal","expressions":{"$id":"200","Literal":"FaultedWorkflowInstances"}},{"$id":"201","name":"Values","syntax":"JavaScript","expressions":{"$id":"202","Json":"","JavaScript":"let i = getVariable(\"Instance\")\r\nlet w = getVariable(\"Workflow\")\r\nreturn {\r\n    \"Title\":w.displayName +' v '+ i.version + \" fault at \"+ new Date(i.faultedAt).toLocaleDateString(),\r\n    \"FaultDate\":new Date(i.faultedAt),\r\n    \"WorkflowInstanceID\":i.id,\r\n    \"WorkflowVersion\":i.version,\r\n    \"WorkflowDisplayName\":w.displayName,\r\n    \"WorkflowName\":w.name,\r\n    \"ReportedDate\":new Date(),\r\n    }"}},{"$id":"203","name":"VariableName","expressions":{"$id":"204","Literal":"FaultedWorkflowInstance"}}],"propertyStorageProviders":{"$id":"205"}},{"$id":"206","activityId":"62b710f8-d852-4bbe-8fa5-b899c8885125","type":"Correlate","displayName":"Correlate","x":2620,"y":3400,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"207","name":"Value","syntax":"JavaScript","expressions":{"$id":"208","Literal":"Asking for workflow to analyse","JavaScript":"'ask ChatGPT for analysis of '"}}],"propertyStorageProviders":{"$id":"209"}},{"$id":"210","activityId":"cd31f2f6-64c6-42fa-bf4c-168762b70694","type":"SendHttpRequest","name":"getWorkflowExecutionLog","displayName":"Send HTTP Request getWorkflowExecutionLog","x":1960,"y":3160,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"211","name":"Url","syntax":"JavaScript","expressions":{"$id":"212","Literal":"https://localhost:7063/v1/workflow-instances?","JavaScript":"'https://'+getVariable(\"host\")+'/v1/workflow-instances/'+getVariable(\"Instance\").id+'/execution-log'"}},{"$id":"213","name":"Method","expressions":{"$id":"214","Literal":"GET"}},{"$id":"215","name":"Content","expressions":{"$id":"216"}},{"$id":"217","name":"ContentType","expressions":{"$id":"218","Literal":"application/json"}},{"$id":"219","name":"ReadContent","expressions":{"$id":"220","Literal":"true"}},{"$id":"221","name":"ResponseContentParserName","expressions":{"$id":"222","Literal":""}},{"$id":"223","name":"ResponseContentTargetType","expressions":{"$id":"224"}},{"$id":"225","name":"SupportedStatusCodes","expressions":{"$id":"226","Json":"[\"200\"]"}},{"$id":"227","name":"Authorization","expressions":{"$id":"228","Secret":"OAuth2:newJimtest API oAuth"}},{"$id":"229","name":"RequestHeaders","expressions":{"$id":"230"}}],"propertyStorageProviders":{"$id":"231"}},{"$id":"232","activityId":"e7e957c0-e1f3-45fc-831b-ca9319cff3a6","type":"SetVariable","displayName":"Set ExecutionLog","x":2740,"y":3160,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"233","name":"VariableName","expressions":{"$id":"234","Literal":"ExecutionLog"}},{"$id":"235","name":"Value","syntax":"JavaScript","expressions":{"$id":"236","JavaScript":"activities.getWorkflowDefinition.ResponseContent()"}}],"propertyStorageProviders":{"$id":"237"}},{"$id":"238","activityId":"a77748ae-6463-4208-b15b-30798de2f575","type":"Fault","displayName":"Fault","x":-640,"y":1920,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"239","name":"Message","expressions":{"$id":"240","Literal":"unsupported status code asking for workflow instances"}}],"propertyStorageProviders":{"$id":"241"}},{"$id":"242","activityId":"c4e567a1-e2b3-4bba-bf90-9f4c0a91dadc","type":"Fault","displayName":"Fault","x":1740,"y":2660,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"243","name":"Message","expressions":{"$id":"244","Literal":"unsupported status code asking for workflow fault log"}}],"propertyStorageProviders":{"$id":"245"}},{"$id":"246","activityId":"ef9b2169-366b-4998-9fa9-dd69689bc7d5","type":"Fault","displayName":"Fault","x":1559,"y":3103,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"247","name":"Message","expressions":{"$id":"248","Literal":"unsupported status code asking for workflow definition"}}],"propertyStorageProviders":{"$id":"249"}},{"$id":"250","activityId":"9b04672d-a1cb-4018-87d8-2c05b5c125a2","type":"Fault","displayName":"Fault","x":1752,"y":3324,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"251","name":"Message","expressions":{"$id":"252","Literal":"unsupported status code asking for workflow execution log"}}],"propertyStorageProviders":{"$id":"253"}},{"$id":"254","activityId":"8831561b-188f-4044-bd02-950a3f29de6c","type":"Fault","displayName":"Fault","x":3477,"y":3633,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"255","name":"Message","expressions":{"$id":"256","Literal":"request to ChatGPT failed"}}],"propertyStorageProviders":{"$id":"257"}},{"$id":"258","activityId":"9989f53c-b4a7-4f48-9972-371da4e92e54","type":"HttpEndpoint","name":"httpDeleteFault","displayName":"POST /deleteFault","x":-80,"y":2620,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"259","name":"Path","expressions":{"$id":"260","Literal":"/deleteFault"}},{"$id":"261","name":"Methods","expressions":{"$id":"262","Json":"[\"POST\"]"}},{"$id":"263","name":"ReadContent","expressions":{"$id":"264","Literal":"true"}},{"$id":"265","name":"TargetType","expressions":{"$id":"266"}},{"$id":"267","name":"Schema","syntax":"Literal","expressions":{"$id":"268","Literal":""}},{"$id":"269","name":"Authorize","expressions":{"$id":"270"}},{"$id":"271","name":"Policy","expressions":{"$id":"272"}},{"$id":"273","name":"AuthorizeWithCustomHeader","expressions":{"$id":"274"}},{"$id":"275","name":"CustomHeaderName","expressions":{"$id":"276"}},{"$id":"277","name":"CustomHeaderValue","expressions":{"$id":"278"}}],"propertyStorageProviders":{"$id":"279"}},{"$id":"280","activityId":"0442921e-bb50-4828-b3be-d1da8d4671b2","type":"Correlate","displayName":"Correlate","x":280,"y":2600,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"281","name":"Value","expressions":{"$id":"282","Literal":"deleteFault"}}],"propertyStorageProviders":{"$id":"283"}},{"$id":"284","activityId":"c564da50-8096-43e1-b5fb-8389326264f2","type":"ObjectInstanceUpdate","displayName":"Update Object Instance","x":260,"y":2460,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"285","name":"InstanceId","syntax":"JavaScript","expressions":{"$id":"286","JavaScript":"activities.httpAcknowledgeFault.Output().body.objectId"}},{"$id":"287","name":"ClearOmittedFields","expressions":{"$id":"288"}},{"$id":"289","name":"Values","syntax":"JavaScript","expressions":{"$id":"290","JavaScript":"return {\r\n    \"Acknowledged\":true,\r\n    \"AcknowledgedDate\":new Date()\r\n}"}},{"$id":"291","name":"VariableName","expressions":{"$id":"292"}}],"propertyStorageProviders":{"$id":"293"}},{"$id":"294","activityId":"aede5eb0-2e04-42d6-aff0-e3dff615b825","type":"Correlate","displayName":"Correlate","x":260,"y":2340,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"295","name":"Value","expressions":{"$id":"296","Literal":"acknowledgeFault"}}],"propertyStorageProviders":{"$id":"297"}},{"$id":"298","activityId":"3c658a85-6b97-4dee-a8e0-86f17419f05e","type":"HttpEndpoint","name":"httpAcknowledgeFault","displayName":"POST /acknowledgeFault","x":-120,"y":2320,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"299","name":"Path","expressions":{"$id":"300","Literal":"/acknowledgeFault"}},{"$id":"301","name":"Methods","expressions":{"$id":"302","Json":"[\"GET\",\"POST\"]"}},{"$id":"303","name":"ReadContent","expressions":{"$id":"304","Literal":"true"}},{"$id":"305","name":"TargetType","expressions":{"$id":"306"}},{"$id":"307","name":"Schema","syntax":"Literal","expressions":{"$id":"308","Literal":""}},{"$id":"309","name":"Authorize","expressions":{"$id":"310"}},{"$id":"311","name":"Policy","expressions":{"$id":"312"}},{"$id":"313","name":"AuthorizeWithCustomHeader","expressions":{"$id":"314"}},{"$id":"315","name":"CustomHeaderName","expressions":{"$id":"316"}},{"$id":"317","name":"CustomHeaderValue","expressions":{"$id":"318"}}],"propertyStorageProviders":{"$id":"319"}},{"$id":"320","activityId":"778ffdd8-dc97-4bc9-ac8e-175ad8ef8a2e","type":"ObjectInstanceGet","displayName":"Get FaultedWorkflowInstance","x":380,"y":2720,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"321","name":"InstanceId","syntax":"JavaScript","expressions":{"$id":"322","JavaScript":"activities.httpDeleteFault.Output().body.objectId"}},{"$id":"323","name":"Expanded","expressions":{"$id":"324"}},{"$id":"325","name":"VariableName","expressions":{"$id":"326","Literal":"FaultedWorkflowInstance"}}],"propertyStorageProviders":{"$id":"327"}},{"$id":"328","activityId":"4c4d58d5-3ed9-410b-b136-b0a6f0489377","type":"SendHttpRequest","name":"getFaultedLog","displayName":"Send HTTP Request getFaultedLog","x":1580,"y":2500,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"329","name":"Url","syntax":"JavaScript","expressions":{"$id":"330","Literal":"https://localhost:7063/v1/workflow-instances?","JavaScript":"'https://'+getVariable(\"host\")+'/v1/workflow-instances/'+getVariable(\"Instance\").id"}},{"$id":"331","name":"Method","expressions":{"$id":"332","Literal":"GET"}},{"$id":"333","name":"Content","expressions":{"$id":"334"}},{"$id":"335","name":"ContentType","expressions":{"$id":"336","Literal":"application/json"}},{"$id":"337","name":"ReadContent","expressions":{"$id":"338","Literal":"true"}},{"$id":"339","name":"ResponseContentParserName","expressions":{"$id":"340","Literal":""}},{"$id":"341","name":"ResponseContentTargetType","expressions":{"$id":"342"}},{"$id":"343","name":"SupportedStatusCodes","expressions":{"$id":"344","Json":"[\"200\"]"}},{"$id":"345","name":"Authorization","expressions":{"$id":"346","Secret":"OAuth2:newJimtest API oAuth"}},{"$id":"347","name":"RequestHeaders","expressions":{"$id":"348"}}],"propertyStorageProviders":{"$id":"349"}},{"$id":"350","activityId":"65edcbe7-5c07-4f4f-97c8-7446259f2803","type":"SendHttpRequest","name":"deleteFaultedLog","displayName":"Send HTTP Request deleteFaultedLog","x":880,"y":2720,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"351","name":"Url","syntax":"JavaScript","expressions":{"$id":"352","Literal":"https://localhost:7063/v1/workflow-instances?","JavaScript":"'https://'+getVariable(\"host\")+'/v1/workflow-instances/'+getVariable(\"FaultedWorkflowInstance\").WorkflowInstanceID"}},{"$id":"353","name":"Method","expressions":{"$id":"354","Literal":"DELETE"}},{"$id":"355","name":"Content","expressions":{"$id":"356"}},{"$id":"357","name":"ContentType","expressions":{"$id":"358","Literal":"application/json"}},{"$id":"359","name":"ReadContent","expressions":{"$id":"360","Literal":"true"}},{"$id":"361","name":"ResponseContentParserName","expressions":{"$id":"362","Literal":""}},{"$id":"363","name":"ResponseContentTargetType","expressions":{"$id":"364"}},{"$id":"365","name":"SupportedStatusCodes","expressions":{"$id":"366","Json":"[\"204\",\"404\"]"}},{"$id":"367","name":"Authorization","expressions":{"$id":"368","Secret":"OAuth2:newJimtest API oAuth"}},{"$id":"369","name":"RequestHeaders","expressions":{"$id":"370"}}],"propertyStorageProviders":{"$id":"371"}},{"$id":"372","activityId":"e34cd852-9515-411d-aff0-570193ffe95e","type":"SetVariable","displayName":"Set host","x":-840,"y":1120,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"373","name":"VariableName","expressions":{"$id":"374","Literal":"host"}},{"$id":"375","name":"Value","syntax":"JavaScript","expressions":{"$id":"376","JavaScript":"activities.httpStart.Output().Headers.Host"}}],"propertyStorageProviders":{"$id":"377"}},{"$id":"378","activityId":"639c1e58-2a6e-4bfb-825f-254074f637c8","type":"SetVariable","displayName":"Set host","x":600,"y":2600,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"379","name":"VariableName","expressions":{"$id":"380","Literal":"host"}},{"$id":"381","name":"Value","syntax":"JavaScript","expressions":{"$id":"382","JavaScript":"activities.httpDeleteFault.Output().Headers.Host"}}],"propertyStorageProviders":{"$id":"383"}},{"$id":"384","activityId":"c6d834f1-652c-45f0-a418-e1795f42d76a","type":"DeleteObjectInstance","displayName":"Delete Object Instance","x":1140,"y":2880,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"385","name":"ObjectInstanceId","syntax":"JavaScript","expressions":{"$id":"386","JavaScript":"activities.httpDeleteFault.Output().body.objectId"}}],"propertyStorageProviders":{"$id":"387"}},{"$id":"388","activityId":"b3c3629d-5b4e-4d7c-8a86-345a9d9fa2a1","type":"Cron","displayName":"Cron","x":-1400,"y":1300,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"389","name":"CronExpression","expressions":{"$id":"390","Literal":"0 0/10 * ? * * *"}}],"propertyStorageProviders":{"$id":"391"}},{"$id":"392","activityId":"c294e34c-446c-4de2-b425-e08046ec8bdc","type":"SetVariable","displayName":"Set WorkflowInstances","x":-280,"y":1760,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"393","name":"VariableName","expressions":{"$id":"394","Literal":"WorkflowInstances"}},{"$id":"395","name":"Value","syntax":"JavaScript","expressions":{"$id":"396","JavaScript":"activities.requestFaultedWorkflowInstances.ResponseContent()"}}],"propertyStorageProviders":{"$id":"397"}},{"$id":"398","activityId":"d1cf4030-df3c-4483-a93a-574df99d6d37","type":"ForEach","name":"forEachWorkflowInstances","displayName":"For Each WorkflowInstances","x":-40,"y":1900,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"399","name":"Items","syntax":"JavaScript","expressions":{"$id":"400","JavaScript":"getVariable(\"WorkflowInstances\").items"}}],"propertyStorageProviders":{"$id":"401"}},{"$id":"402","activityId":"aac8914b-3caf-48cc-a1f1-789cb32dc4dc","type":"SetVariable","displayName":"Set Instance","x":440,"y":1900,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"403","name":"VariableName","expressions":{"$id":"404","Literal":"Instance"}},{"$id":"405","name":"Value","syntax":"JavaScript","expressions":{"$id":"406","JavaScript":"activities.forEachWorkflowInstances.Output()"}}],"propertyStorageProviders":{"$id":"407"}},{"$id":"408","activityId":"221f4153-7d90-4aac-83c1-bafb2ecb756a","type":"RemoveWorkflowInstances","displayName":"Clear Workflow Instances","x":80,"y":2120,"persistWorkflow":false,"loadWorkflowContext":false,"saveWorkflowContext":false,"properties":[{"$id":"409","name":"WorkflowDefinitionName","syntax":"JavaScript","expressions":{"$id":"410","JavaScript":"getWorkflowDefinitionIdByName(\"MonitorWorkflowFaults\")"}},{"$id":"411","name":"VersionSelection","expressions":{"$id":"412","Literal":"All"}},{"$id":"413","name":"CustomVersion","expressions":{"$id":"414"}},{"$id":"415","name":"InstanceRetention","expressions":{"$id":"416","Literal":"3"}},{"$id":"417","name":"DateSelection","expressions":{"$id":"418"}},{"$id":"419","name":"IncludeIdle","expressions":{"$id":"420"}},{"$id":"421","name":"IncludeSuspended","expressions":{"$id":"422"}},{"$id":"423","name":"IncludeRunning","expressions":{"$id":"424"}}],"propertyStorageProviders":{"$id":"425"}}],"connections":[{"$id":"426","sourceActivityId":"c294e34c-446c-4de2-b425-e08046ec8bdc","targetActivityId":"d1cf4030-df3c-4483-a93a-574df99d6d37","outcome":"Done"},{"$id":"427","sourceActivityId":"d1cf4030-df3c-4483-a93a-574df99d6d37","targetActivityId":"aac8914b-3caf-48cc-a1f1-789cb32dc4dc","outcome":"Iterate"},{"$id":"428","sourceActivityId":"aac8914b-3caf-48cc-a1f1-789cb32dc4dc","targetActivityId":"999060f3-1ca9-4913-a28d-16bba56358fd","outcome":"Done"},{"$id":"429","sourceActivityId":"999060f3-1ca9-4913-a28d-16bba56358fd","targetActivityId":"84a50058-070f-4e3c-9591-6bd3555fd11c","outcome":"Done"},{"$id":"430","sourceActivityId":"84a50058-070f-4e3c-9591-6bd3555fd11c","targetActivityId":"62b89480-77c1-4608-b343-e5c46a9d4bb4","outcome":"Done"},{"$id":"431","sourceActivityId":"2b9817bf-3a71-44dd-854a-4a0a29702da1","targetActivityId":"5f139e7c-82f9-45ab-80e7-8738836039ac","outcome":"Done"},{"$id":"432","sourceActivityId":"3a7818dd-4d67-45a9-b0e8-c6d2eadeca81","targetActivityId":"62b710f8-d852-4bbe-8fa5-b899c8885125","outcome":"Done"},{"$id":"433","sourceActivityId":"62b89480-77c1-4608-b343-e5c46a9d4bb4","targetActivityId":"4c4d58d5-3ed9-410b-b136-b0a6f0489377","outcome":"False"},{"$id":"434","sourceActivityId":"5f139e7c-82f9-45ab-80e7-8738836039ac","targetActivityId":"9da2b7ba-c5d7-423f-b589-c61a0b4f41bb","outcome":"Done"},{"$id":"435","sourceActivityId":"c25137b1-d9e7-4830-943b-9977e992a7b6","targetActivityId":"f70a46a8-a91f-45e4-8135-2073c87efc06","outcome":"Done"},{"$id":"436","sourceActivityId":"0d6d4e73-df64-4c6d-869e-2797047e80e8","targetActivityId":"c25137b1-d9e7-4830-943b-9977e992a7b6","outcome":"Done"},{"$id":"437","sourceActivityId":"9da2b7ba-c5d7-423f-b589-c61a0b4f41bb","targetActivityId":"3bb46982-bf0a-436f-a9bb-2938772ad535","outcome":"Done"},{"$id":"438","sourceActivityId":"3bb46982-bf0a-436f-a9bb-2938772ad535","targetActivityId":"6511e0d6-6749-4f1c-b16b-b4a8512d28eb","outcome":"Success"},{"$id":"439","sourceActivityId":"56456f47-07cf-4d30-b47d-fdfdecf6beb7","targetActivityId":"5fdcb542-0428-4a41-8a96-ce7794233087","outcome":"Done"},{"$id":"440","sourceActivityId":"4ba5965d-4790-4c77-9d79-27622e7765d2","targetActivityId":"b6d9495a-628a-4537-89a1-f8be3e1e6b1e","outcome":"Done"},{"$id":"441","sourceActivityId":"5fdcb542-0428-4a41-8a96-ce7794233087","targetActivityId":"4ba5965d-4790-4c77-9d79-27622e7765d2","outcome":"Done"},{"$id":"442","sourceActivityId":"62b710f8-d852-4bbe-8fa5-b899c8885125","targetActivityId":"2b9817bf-3a71-44dd-854a-4a0a29702da1","outcome":"Done"},{"$id":"443","sourceActivityId":"0924eb22-8341-4e1d-85ec-eaf201f2c6a3","targetActivityId":"cd31f2f6-64c6-42fa-bf4c-168762b70694","outcome":"Done"},{"$id":"444","sourceActivityId":"e7e957c0-e1f3-45fc-831b-ca9319cff3a6","targetActivityId":"3a7818dd-4d67-45a9-b0e8-c6d2eadeca81","outcome":"Done"},{"$id":"445","sourceActivityId":"b6d9495a-628a-4537-89a1-f8be3e1e6b1e","targetActivityId":"c294e34c-446c-4de2-b425-e08046ec8bdc","outcome":"200"},{"$id":"446","sourceActivityId":"b6d9495a-628a-4537-89a1-f8be3e1e6b1e","targetActivityId":"a77748ae-6463-4208-b15b-30798de2f575","outcome":"Unsupported Status Code"},{"$id":"447","sourceActivityId":"4c4d58d5-3ed9-410b-b136-b0a6f0489377","targetActivityId":"c4e567a1-e2b3-4bba-bf90-9f4c0a91dadc","outcome":"Unsupported Status Code"},{"$id":"448","sourceActivityId":"4c4d58d5-3ed9-410b-b136-b0a6f0489377","targetActivityId":"0d6d4e73-df64-4c6d-869e-2797047e80e8","outcome":"200"},{"$id":"449","sourceActivityId":"f70a46a8-a91f-45e4-8135-2073c87efc06","targetActivityId":"ef9b2169-366b-4998-9fa9-dd69689bc7d5","outcome":"Unsupported Status Code"},{"$id":"450","sourceActivityId":"f70a46a8-a91f-45e4-8135-2073c87efc06","targetActivityId":"0924eb22-8341-4e1d-85ec-eaf201f2c6a3","outcome":"200"},{"$id":"451","sourceActivityId":"cd31f2f6-64c6-42fa-bf4c-168762b70694","targetActivityId":"e7e957c0-e1f3-45fc-831b-ca9319cff3a6","outcome":"200"},{"$id":"452","sourceActivityId":"cd31f2f6-64c6-42fa-bf4c-168762b70694","targetActivityId":"9b04672d-a1cb-4018-87d8-2c05b5c125a2","outcome":"Unsupported Status Code"},{"$id":"453","sourceActivityId":"2b9817bf-3a71-44dd-854a-4a0a29702da1","targetActivityId":"8831561b-188f-4044-bd02-950a3f29de6c","outcome":"Failed"},{"$id":"454","sourceActivityId":"5ff4b4da-5a07-4dda-9c72-61b414e0f055","targetActivityId":"e34cd852-9515-411d-aff0-570193ffe95e","outcome":"Done"},{"$id":"455","sourceActivityId":"e34cd852-9515-411d-aff0-570193ffe95e","targetActivityId":"56456f47-07cf-4d30-b47d-fdfdecf6beb7","outcome":"Done"},{"$id":"456","sourceActivityId":"3c658a85-6b97-4dee-a8e0-86f17419f05e","targetActivityId":"aede5eb0-2e04-42d6-aff0-e3dff615b825","outcome":"Done"},{"$id":"457","sourceActivityId":"aede5eb0-2e04-42d6-aff0-e3dff615b825","targetActivityId":"c564da50-8096-43e1-b5fb-8389326264f2","outcome":"Done"},{"$id":"458","sourceActivityId":"9989f53c-b4a7-4f48-9972-371da4e92e54","targetActivityId":"0442921e-bb50-4828-b3be-d1da8d4671b2","outcome":"Done"},{"$id":"459","sourceActivityId":"778ffdd8-dc97-4bc9-ac8e-175ad8ef8a2e","targetActivityId":"65edcbe7-5c07-4f4f-97c8-7446259f2803","outcome":"Success"},{"$id":"460","sourceActivityId":"0442921e-bb50-4828-b3be-d1da8d4671b2","targetActivityId":"639c1e58-2a6e-4bfb-825f-254074f637c8","outcome":"Done"},{"$id":"461","sourceActivityId":"639c1e58-2a6e-4bfb-825f-254074f637c8","targetActivityId":"778ffdd8-dc97-4bc9-ac8e-175ad8ef8a2e","outcome":"Done"},{"$id":"462","sourceActivityId":"65edcbe7-5c07-4f4f-97c8-7446259f2803","targetActivityId":"c6d834f1-652c-45f0-a418-e1795f42d76a","outcome":"204"},{"$id":"463","sourceActivityId":"65edcbe7-5c07-4f4f-97c8-7446259f2803","targetActivityId":"c6d834f1-652c-45f0-a418-e1795f42d76a","outcome":"404"},{"$id":"464","sourceActivityId":"d1cf4030-df3c-4483-a93a-574df99d6d37","targetActivityId":"221f4153-7d90-4aac-83c1-bafb2ecb756a","outcome":"Done"}],"id":"f382490eb4824f46a7aa6540ad4a3ed9"}